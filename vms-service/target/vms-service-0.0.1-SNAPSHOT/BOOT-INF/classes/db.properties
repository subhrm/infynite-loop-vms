sql.connectionCheck=select 1 from dual
sql.login=SELECT id, name, email, role_code FROM vms_users WHERE email=? AND password=?
sql.login.access=select v.visitor_type_cd, v.visitor_type_desc from vms_users u join role_visitor_access r on u.role_code=r.role_code join visitor_type v on r.visitor_type_cd=v.visitor_type_cd where u.id=?
sql.visitor.lastDays=SELECT COUNT(1) as count, visitor_date as date FROM ( SELECT id visitor_id, DATE_FORMAT(expected_in_time, '%Y-%m-%d') visitor_date FROM visitor WHERE DATE(expected_in_time) BETWEEN CURDATE()-7 AND CURDATE()-1) v GROUP BY visitor_date
sql.visitor.today=SELECT COUNT(1) total, IFNULL(SUM(IF(status = 1, 1, 0)), 0) inside, IFNULL(SUM(IF(status <> 1, 1, 0)), 0) remaining FROM visitor WHERE DATE(expected_in_time) = CURDATE()
sql.visitor.profile=SELECT v.id visitor_id, t.visitor_type_desc visitor_type, v.name, v.email, v.mobile, i.image_data photo, e.name referred_by, DATE_FORMAT( expected_in_time, "%Y-%m-%d %H:%i:%s" ) expected_in_time, DATE_FORMAT(actual_in_time, "%Y-%m-%d %H:%i:%s") actual_in_time, DATE_FORMAT( expected_out_time, "%Y-%m-%d %H:%i:%s" ) expected_out_time, v.status status FROM vms.visitor v JOIN vms.images i ON v.uploaded_photo = i.image_id JOIN vms.visitor_type t ON v.visitor_type_cd = t.visitor_type_cd LEFT OUTER JOIN vms.employee e ON v.refered_by = e.id WHERE v.id=?
sql.employee.family=select f.name, f.email, f.mobile, f.relation, i.image_data photo from employee_family f left outer join images i on f.photo=i.image_id where f.emp_id=?
sql.visitor.register=INSERT INTO visitor(visitor_type_cd, name, email, mobile, uploaded_photo, refered_by, expected_in_time, expected_out_time, status, is_spot_registration) VALUES ( ?, ?, ?, ?, ?, ?, str_to_date(?, '%Y-%m-%d %H:%i:%s'), str_to_date(?, '%Y-%m-%d %H:%i:%s'), ?, ?)
sql.visitor.inside=SELECT v.id visitor_id, t.visitor_type_cd visitor_type, t.visitor_type_desc visitor_type_desc, v.name, e.name referred_by FROM visitor v JOIN visitor_type t ON v.visitor_type_cd = t.visitor_type_cd LEFT OUTER JOIN employee e ON v.refered_by = e.id WHERE v.status = 1
sql.image.fetch=select image_data from images where image_id=?
sql.visitor.approver.byEmpId=SELECT name, email, mobile FROM employee where id=?
sql.visitor.approver.byVType=SELECT e.name, e.email, e.mobile FROM employee e JOIN default_approver a ON e.id=a.emp_id where a.visitor_type_cd=?
sql.approver.eligibility=select v.id, v.status, v.refered_by, a.emp_id df_approver from visitor v left outer join default_approver a on v.visitor_type_cd=a.visitor_type_cd where v.id=?
sql.visitor.approve=update visitor set status=?, refered_by=? where id=?